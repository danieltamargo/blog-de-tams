---
import Layout from './Layout.astro';
import TechConcept from '@components/TechConcept.astro';
import { getCollection } from 'astro:content';

const { frontmatter } = Astro.props;

// Obtener todas las publicaciones y ordenarlas por fecha
const posts = await getCollection('tech-concepts');
const sortedPosts = posts.sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Encontrar el índice del post actual
const currentIndex = sortedPosts.findIndex(post => post.data.title === frontmatter.title);
const prevPost = currentIndex < sortedPosts.length - 1 ? sortedPosts[currentIndex + 1] : null;
const nextPost = currentIndex > 0 ? sortedPosts[currentIndex - 1] : null;

// Obtener y configurar la animación en función de la dirección de navegación
const direction = Astro.cookies.get('post-navigation-direction')?.value;
Astro.cookies.delete('post-navigation-direction');

const postAnimation = {
  old: {
    name: direction === 'backward' ? 'slide-from-left' : 'slide-from-right',
    duration: '200ms',
    easing: 'ease-in',
    direction: 'reverse',
  },
  new: {
    name: direction === 'backward' ? 'slide-from-right' : 'slide-from-left',
    duration: '200ms',
    easing: 'ease-in-out',
  },
};

const customTransition = {
  forwards: postAnimation,
  backwards: postAnimation,
};
---

<Layout title={frontmatter.title}>
  <TechConcept 
    frontmatter={frontmatter} 
    prevPost={prevPost} 
    nextPost={nextPost} 
    animation={customTransition} 
  >
    <slot />  
  </TechConcept>
</Layout>
